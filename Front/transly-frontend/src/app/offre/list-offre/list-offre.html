<div class="container">
  <h2>Liste de mes offres</h2>
  <div class="filters">
  <!-- üîç Recherche par prix -->
  <input type="number" [(ngModel)]="searchPrix" placeholder="Prix minimum" class="form-control" />

  <!-- üì¶ Filtre par d√©lai -->
  <input type="number" [(ngModel)]="filterDelai" placeholder="D√©lai max (jours)" class="form-control" />

  <!-- üìÖ Filtre par date -->
<input type="date" [(ngModel)]="filterDate" class="form-control" />

  <!-- üéØ Filtre par statut -->
  <select [(ngModel)]="filterStatut" class="form-control">
    <option value="">Tous les statuts</option>
    <option value="En attente">En attente</option>
    <option value="Accept√©e">Accept√©e</option>
    <option value="Refus√©e">Refus√©e</option>
  </select>
</div>


  <div *ngIf="errorMessage" class="error">
    {{ errorMessage }}
  </div>

  <div *ngIf="offres.length === 0 && !errorMessage">
    Aucune offre trouv√©e.
  </div>

  <!-- <div *ngFor="let o of offres" class="card"> -->
    <div *ngFor="let o of filteredOffres()" class="card">
    <p><strong>Prix propos√© :</strong> {{ o.prixPropose }} TND</p>
    <p><strong>D√©lai de livraison :</strong> {{ o.delaiLivraison }} jours</p>
    <p><strong>Statut :</strong> {{ o.statut }}</p>
    <p><strong>Date de l'offre :</strong> {{ o.dateOffre | date:'dd/MM/yyyy' }}</p>

    <hr />
    <div style="margin-top: 1rem; margin-left: 25%;">
      <button class="btn btn-details" (click)="ouvrirModal(o, 'details')">D√©tails</button>
      <button class="btn btn-modifier" (click)="ouvrirModal(o, 'edit')">Modifier</button>
      <button class="btn btn-supprimer" (click)="ouvrirModal(o, 'delete')">Supprimer</button>
         <!-- ‚úÖ Affichage du bouton si statut est Accept√©e -->
    <button *ngIf="o.statut === 'Accept√©e'" class="btn btn-pch" (click)="ouvrirModal(o, 'priseEnCharge')">Prise en charge</button>
    </div>
  </div>
</div>


<!-- ‚úÖ Modal Prise en charge -->
<div class="modal" [class.show]="modalType === 'priseEnCharge'">
  <div class="modal-content">
    <span class="close" (click)="fermerModal()">&times;</span>
    <h3>Confirmation de prise en charge</h3>
    <p>Voulez-vous accepter la prise en charge de cette offre ?</p>
    <div class="buttons">
      <button (click)="changerPriseEnCharge('oui')">Oui</button>
      <button (click)="changerPriseEnCharge('non')">Non</button>
    </div>
  </div>
</div>


<!-- üü¶ Modal D√©tails -->
<div class="modal" [class.show]="modalType === 'details'">
  <div class="modal-content">
    <span class="close" (click)="fermerModal()">&times;</span>
    <h3>D√©tails de l'offre</h3>
    <p><strong>Prix propos√© :</strong> {{ selectedOffre?.prixPropose }} TND</p>
    <p><strong>D√©lai de livraison :</strong> {{ selectedOffre?.delaiLivraison }} jours</p>
    <p><strong>Statut :</strong> {{ selectedOffre?.statut }}</p>
    <p><strong>Date :</strong> {{ selectedOffre?.dateOffre | date:'dd/MM/yyyy' }}</p>
    <div class="buttons">
      <button (click)="fermerModal()">Fermer</button>
    </div>
  </div>
</div>

<!-- üü® Modal Modifier -->
<ng-container *ngIf="modalType === 'edit'">
  <div class="modal show">
    <div class="modal-content">
      <span class="close" (click)="fermerModal()">&times;</span>
      <h3>Modifier l'offre</h3>

      <form (ngSubmit)="modifierOffre()" class="form-edit-demande">

        <div class="form-group mb-3">
          <label for="prixPropose">Prix propos√©</label>
          <input
            type="number"
            id="prixPropose"
            [(ngModel)]="selectedOffre!.prixPropose"
            name="prixPropose"
            class="form-control"
            required
          />
        </div>

        <div class="form-group mb-3">
          <label for="delaiLivraison">D√©lai de livraison (jours)</label>
          <input
            type="number"
            id="delaiLivraison"
            [(ngModel)]="selectedOffre!.delaiLivraison"
            name="delaiLivraison"
            class="form-control"
            required
          />
        </div>

    

        <div class="buttons">
          <button type="submit">Enregistrer</button>
          <button type="button" (click)="fermerModal()">Annuler</button>
        </div>
      </form>
    </div>
  </div>
</ng-container>


<!-- üü• Modal Supprimer -->
<div class="modal" [class.show]="modalType === 'delete'">
  <div class="modal-content">
    <span class="close" (click)="fermerModal()">&times;</span>
    <h3>Confirmer la suppression</h3>
    <p>√ätes-vous s√ªr de vouloir supprimer cette offre ?</p>
    <div class="buttons">
      <button (click)="confirmerSuppression()">Oui, supprimer</button>
      <button (click)="fermerModal()">Annuler</button>
    </div>
  </div>
</div>
